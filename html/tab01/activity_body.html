<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>活动详情</title>
		<link href="../../css/Hui.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="http://at.alicdn.com/t/font_354149_a6vmvwdw4m927qfr.css">
		<style type="text/css">
			.userDiv {
				width: 30px;
				height: 30px;
				position: absolute;
				border: 1px solid rgba(230, 230, 230, 0.47);
			}
			.userImg {
				width: 30px;
				height: 30px;
			}
			.vux-masker-box {
				position: relative;
			}
			.m-img {
				padding-bottom: 50%;
				display: block;
				position: relative;
				max-width: 100%;
				background-size: cover;
				background-position: center center;
				cursor: pointer;
				/*border-radius: 2px;*/
			}
			.vux-masker {
				position: absolute;
				top: 0;
				left: 0;
				bottom: 0;
				right: 0;
				border-radius: inherit;
			}
			.m-title {
				color: #fff;
				text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
				font-weight: 500;
				font-size: 16px;
				position: absolute;
				left: 0;
				right: 0;
				width: 100%;
				text-align: right;
				bottom: 2px;
				/*padding-left: 10px;
				 -webkit-transform: translateY(-50%);
				 transform: translateY(-50%);*/
			}
		</style>
	</head>
	<body>
		<div id="activeDetail"></div>
		<script id="tpl_activeDetail" type="text/html">
		<div class="router-view">
			<div style="overflow: hidden;">
				<div class="vux-masker-box">
					<div class="m-img" style="background-image: url([:=list.activity.pic:]);"></div>
					<div class="vux-masker">
						<div class="m-title">
							[:if(list.activity.fee==0){:]
							<span class="H-text-align-right H-theme-font-color-white H-font-size-16" style="border-radius:15px 0 0 15px;background:-webkit-linear-gradient(0deg, #2AC09F 0%, #5cb85c 100%);padding: 5px 12px;">免费
</span>
							[:}else{:]
							<span class="H-text-align-right H-theme-font-color-white H-font-size-16" style="border-radius:15px 0 0 15px;background:-webkit-linear-gradient(0deg, #FD5658 0%, #c73b03 100%);padding: 5px 12px;">¥[:=list.activity.fee:]</span>
							[:}:]
						</div>
					</div>
				</div>
				<div class="H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after">
					<div class="H-flex-item H-padding-10">
						<strong class="H-font-weight-normal font-weight-500 H-font-size-18 H-display-block">
							[:=list.activity.name:]
						</strong>
						<div class="H-font-size-12 H-theme-font-color-999 H-text-show-row-2 H-margin-vertical-top-2">
							发表时间：[:=(list.activity.create_time).split('T')[0]:]
						</div>
					</div>
				</div>
			</div>
		</div>
		<div>
			<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
				<span class="H-icon H-display-block H-margin-horizontal-left-10"><i class="H-iconfont icon-huodongxiangqing-shijian H-font-size-19 H-vertical-middle H-theme-font-color-999"></i></span>
				<div class="H-flex-item H-theme-font-color-999 H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-10">
					[:=(list.activity.start_time).replace('T',' ').split('.')[0]:]至[:=(list.activity.end_time).replace('T',' ').split('.')[0]:]
				</div>
			</div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
				<span class="H-icon H-display-block H-margin-horizontal-left-10"><i class="H-iconfont icon-huodongxiangqing-didian H-font-size-19 H-vertical-middle H-theme-font-color-999"></i></span>
				<div class="H-flex-item H-theme-font-color-999 H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-10">
					[:=list.activity.location:]
				</div>
			</div>
			<div onclick="callPhone('[:=list.contact_way:]')" class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
				<span class="H-icon H-display-block H-margin-horizontal-left-10"><i class="H-iconfont icon-dianhuazixun H-font-size-19 H-vertical-middle H-theme-font-color-999"></i></span>
				<div class="H-flex-item H-theme-font-color-999 H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-10">
					拨打电话
				</div>
			</div>
			<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
				<span class="H-icon H-display-block H-margin-horizontal-left-10"><i class="H-iconfont icon-huodongxiangqing-baomingrenshu H-font-size-19 H-vertical-middle H-theme-font-color-999"></i></span>
				<div class="H-flex-item H-theme-font-color-999 H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-10">
					已报名[:=list.activity.get_join_person_number:]人／限[:=list.activity.people_quota_limit:]人报名
				</div>
			</div>
		</div>
		<div tapmode="" class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle H-touch-active">
			<div class="H-padding-horizontal-left-10 H-padding-vertical-both-5"><img src="[:=list.activity.avatar:]" class="H-vertical-align-middle H-border-radius-circle" style="width: 35px;height:35px;">
			</div>
			<div class="H-flex-item H-padding-horizontal-both-8">
				<span onclick="openUserHomepage(1,'[:=list.create_user:]')" tapmode="" class="H-icon H-display-block H-vertical-middle H-z-index-1000"> <label class=" H-padding-horizontal-right-5">[:=list.activity.cu_nickname:]</label> <label class="H-display-inline-block H-vertical-middle H-font-size-14" style="padding:2px 10px;border-radius: 15px;border: 1px solid #FF7C47;color:#FF7C47;">发布者</label></span>
			</div>
			<span class="H-icon H-padding-horizontal-right-10 H-display-block"><i class="H-iconfont H-icon-arrow-right H-theme-font-color-999 H-font-size-14 H-vertical-middle"></i></span>
		</div>
		<div class="H-padding-vertical-bottom-10"></div>
		<div class="H-theme-background-color-white">
			<div class="H-center-all H-padding-vertical-both-10">
				<div>
					<span class="H-icon H-display-block H-line-height-normal">活动详情</span>
					<div class="H-center-all H-font-size-11 H-display-block H-font-weight-normal H-padding-vertical-both-2">
						<div class="H-border-radius-5" style="background-color:#FF7C47;width: 30px;height: 4px;"></div>
					</div>
				</div>
			</div>
			<div id="details" class="H-theme-background-color-white H-theme-font-color-333 H-padding-horizontal-both-10 H-font-size-15 H-margin-vertical-both-10 H-text-show-row-3">
				[:=list.activity.description:]
			</div>
			<div onclick="showDetailMore(this)" tapmode="" data-showOpen="false" class="H-center-all H-padding-vertical-both-10 H-border-vertical-top-after color">
				<span>展开所有详情</span>
				<span class="H-icon H-padding-horizontal-both-5 H-display-block"><i class="H-iconfont H-icon-arrow-down H-font-size-16 H-vertical-middle"></i></span>
			</div>
		</div>
		<div class="H-padding-vertical-bottom-10"></div>
		<div class="H-center-all H-padding-vertical-both-5 H-theme-background-color-white">
			<div onclick="openEnrolList()" tapmode="" class="H-text-list H-flexbox-horizontal H-vertical-middle">
				<span class="H-display-block H-font-size-16 H-padding-horizontal-both-10 H-theme-font-color-333">已报名人员</span>
				<div class="H-flex-item H-padding-horizontal-both-8 H-font-size-16 H-padding-vertical-both-10 H-theme-font-color-444 H-height-50 H-text-align-right H-position-relative">
					[:if(list.activityuser_list.length>0){:]
					[:var len = list.activityuser_list.length>7?7:list.activityuser_list.length;:]
					[: for (var i=len-1;i>=0;i--) { :]
					<div class="H-center-all H-border-radius-circle userDiv" style="right:[:=i*20:]px;"><img src="[:=list.activityuser_list[i].avatar:]" class="H-center-all H-vertical-align-middle H-border-radius-circle userImg" alt="" title="" /></div>
					[:}}else{:]
						<!-- <div class="H-theme-font-color-999 H-font-size-16 H-center-all" style="height:30px;">当前暂无报名人员</div> -->
					[:}:]
					<!-- <div class="H-center-all H-border-radius-circle userDiv" style="right: 80px;"><img src="../../image/userImg/user02.jpg" class="H-center-all H-vertical-align-middle H-border-radius-circle userImg" alt="" title="" />
					</div>
					<div class="H-center-all H-border-radius-circle userDiv" style="right: 60px;"><img src="../../image/userImg/nouser1.jpg" class="H-center-all H-vertical-align-middle H-border-radius-circle userImg" alt="" title="" />
					</div>
					<div class="H-center-all H-border-radius-circle userDiv" style="right: 40px;"><img src="../../image/userImg/user05.jpg" class="H-vertical-align-middle H-border-radius-circle userImg" alt="" title="" />
					</div>
					<div class="H-center-all H-border-radius-circle userDiv" style="right: 20px;"><img src="../../image/userImg/user04.jpg" class="H-vertical-align-middle H-border-radius-circle userImg" alt="" title="" />
					</div>
					<div class="H-center-all H-border-radius-circle userDiv" style="right: 0px;"><img src="../../image/userImg/user03.jpg" class="H-vertical-align-middle H-border-radius-circle userImg" alt="" title="" />
					</div> -->
				</div>
				<span class="H-display-block H-font-size-14 H-padding-horizontal-both-10 H-theme-font-color-666">共[:=list.activity.get_applicant_number:]人</span>
				<span class="H-icon H-padding-horizontal-right-10 H-display-block"><i class="H-iconfont H-icon-arrow-right H-theme-font-color-999 H-font-size-14 H-vertical-middle"></i></span>
			</div>
		</div>
		</script>
		<div class="H-padding-vertical-bottom-10"></div>
		<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-vertical-middle">
			<div class="H-padding-horizontal-left-10 H-font-size-16 H-padding-vertical-both-10 H-theme-font-color-444">
				评论
			</div>
			<span id="commentNum" class="H-flex-item H-display-block H-font-size-16 H-margin-horizontal-both-5 H-theme-font-color-999"></span>
			<span class="H-icon H-display-block H-margin-horizontal-right-5 color"><i class="H-iconfont icon-huodongxiangqing-pinglun H-font-size-19 H-vertical-middle"></i></span>
			<span onclick="openComment()" tapmode="" class="H-display-block H-font-size-15 H-margin-horizontal-right-10 color">参与评论</span>
		</div>
		<div id="commentList" class="H-display-none">
			<div class="H-flexbox-horizontal H-box-sizing-border-box H-theme-background-color-white H-clear-both H-padding-horizontal-both-10 H-padding-vertical-both-8 H-border-vertical-top-after">
				<div style="width:40px;height:40px;"><img src="../../image/userImg/user03.jpg" class="H-width-100-percent H-height-100-percent H-display-block H-border-radius-circle H-border-both">
				</div>
				<div class="H-flex-item H-flexbox-vertical H-padding-horizontal-left-10">
					<div class="H-flexbox-horizontal H-width-100-percent">
						<div class="H-flex-item">
							<strong class="H-font-weight-normal H-display-block H-font-size-15 H-text-show-row-1" style="color:#FF7C47;">海阔天空</strong>
							<div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1">
								2017-07-11 11:50
							</div>
						</div>
						<div class="H-font-size-12 H-theme-font-color-999 H-center-all">
							<span class="H-font-size-14 H-flex-item H-center-all"><i class="H-iconfont H-icon-ding-null H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">3</label></span>
						</div>
					</div>
					<div class="H-font-size-15 H-padding-vertical-top-5 H-theme-font-color-666">
						希望大家多支持！
					</div>
				</div>
			</div>
			<div class="H-flexbox-horizontal H-box-sizing-border-box H-theme-background-color-white H-clear-both H-padding-horizontal-both-10 H-padding-vertical-both-8 H-border-vertical-top-after">
				<div style="width:40px;height:40px;"><img src="../../image/userImg/user04.jpg" class="H-width-100-percent H-height-100-percent H-display-block H-border-radius-circle H-border-both">
				</div>
				<div class="H-flex-item H-flexbox-vertical H-padding-horizontal-left-10">
					<div class="H-flexbox-horizontal H-width-100-percent">
						<div class="H-flex-item">
							<strong class="H-font-weight-normal H-display-block H-font-size-15 H-text-show-row-1" style="color:#FF7C47;">清水芙蓉</strong>
							<div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1">
								2017-07-11 12:50
							</div>
						</div>
						<div class="H-font-size-12 H-theme-font-color-999 H-center-all">
							<span class="H-font-size-14 H-flex-item H-center-all"><i class="H-iconfont H-icon-ding-null H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">12</label></span>
						</div>
					</div>
					<div class="H-font-size-15 H-padding-vertical-top-5 H-theme-font-color-666">
						赞赞赞！
					</div>
				</div>
			</div>
		</div>
		<div style="height: 48px;"></div>
		<div id="tabBtn" style="display:none;">
			<div id="showEnrolBtn" class="H-flexbox-horizontal H-box-sizing-border-box H-border-vertical-top-after" style="position: fixed;bottom:0px;z-index: 10000;">
				<div onclick="callPhone()" tapmode="" class="H-flex-item H-center-all H-padding-vertical-both-12 H-font-size-18 H-theme-background-color-white color">
					电话咨询
				</div>
				<div onclick="openEnrol()" tapmode="" class="H-flex-item H-center-all H-padding-vertical-both-12 H-font-size-18 H-theme-font-color-white" style="background-color: #FF7C47;">
					立即报名
				</div>
			</div>
			<div id="hideEnrolBtn" class="H-flexbox-horizontal H-box-sizing-border-box H-border-vertical-top-after" style="position: fixed;bottom:0px;z-index: 10000;">
				<div id="enrolMsg" class="H-flex-item H-center-all H-padding-vertical-both-12 H-font-size-18 H-theme-font-color-white" style="background-color: #ccc;">
					名额已满
				</div>
			</div>
		</div>
		<script id="tpl_commentList" type="text/html">
			[: for (var i=0;i<list.length;i++) { :]
			<div class="H-flexbox-horizontal H-box-sizing-border-box H-theme-background-color-white H-clear-both H-padding-horizontal-both-10 H-padding-vertical-both-8 H-border-vertical-top-after">
				<div onclick="openUserHomepage(0,'[:=list.user:]')" tapmode="" style="width:40px;height:40px;"><img src="[:=list[i].avatar:]" class="H-width-100-percent H-height-100-percent H-display-block H-border-radius-circle H-border-both">
				</div>
				<div class="H-flex-item H-flexbox-vertical H-padding-horizontal-left-10">
					<div class="H-flexbox-horizontal H-width-100-percent">
						<div class="H-flex-item">
							<strong class="H-font-weight-normal H-display-block H-font-size-15 H-text-show-row-1" style="color:#FF7C47;">[:=list[i].nickname:]</strong>
							<div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1">
								[:=((list[i].create_time).split('.')[0]).replace('T',' '):]
							</div>
						</div>
						<!--<div class="H-font-size-12 H-theme-font-color-999 H-center-all">
							<span class="H-font-size-14 H-flex-item H-center-all"><i class="H-iconfont H-icon-ding-null H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">12</label></span>
						</div>-->
					</div>
					<div class="H-font-size-15 H-padding-vertical-top-5 H-theme-font-color-666">
						[:=list[i].description:]
					</div>
				</div>
			</div>
			[:}:]
		</script>
		<script src="../../script/api.js" type="text/javascript"></script>
		<script src="../../script/H.js" type="text/javascript"></script>
		<script src="../../script/setting.js" type="text/javascript"></script>
		<script src="../../script/zepto.min.js" type="text/javascript"></script>
		<script type="text/javascript">
			var userId=null,aid=null,fee=0,has_fee=0,person=0,personCount=0;
			var phone = '';
			apiready = function() {
				loadData();
			};
			function loadData(){
				initDatas();
				initComment();
			};
			function timeFormat(timeStr){
				var str = timeStr.replace('T',' ').split('.')[0];
				H.getNowDateFormat();
			};
			function callPhone() {
				api.call({
				    type: 'tel_prompt',
				    number: phone
				});
			};
			function initDatas(){
				var url = '/fengwan/home/activity/info/get/';
				var data = {
					id:api.pageParam.id
				};
				http(url,'get',data,function(ret){
					log(ret,true);
					var html = H.tppl(H.D('#tpl_activeDetail').innerHTML, {
						list : ret.data
					});
					$("#activeDetail").html(html).fadeIn();
					aid = ret.data.activity.id;
					fee = ret.data.activity.fee;
					has_fee = ret.data.activity.has_fee;
					person = ret.data.activity.get_join_person_number;
					personCount = ret.data.activity.people_quota_limit;
					phone = ret.data.activity.contact_way;
					var commentNum = ret.data.activity.get_comment_number;
					$('#commentNum').html(commentNum);
					var status = ret.data.activity.status;
					if(status<2){
						isShowEnrolBtn();
					}else{
						$('#tabBtn').css({'display':'block'});
						$('#showEnrolBtn').css({'display':'none'});
						$('#hideEnrolBtn').css({'display':'block'});
						$('#enrolMsg').html('活动已结束');
					}
					api.parseTapmode();
				},function(ret,err){

				});
			};
			function isShowEnrolBtn(){
				$('#tabBtn').css({'display':'block'});
				if(person>=personCount){
					$('#showEnrolBtn').css({'display':'none'});
					$('#hideEnrolBtn').css({'display':'block'});
				}else{
					$('#showEnrolBtn').css({'display':'-webkit-box'});
					$('#hideEnrolBtn').css({'display':'none'});
				}
			};

			function initComment() {
				var url = '/logic/fengwan/home/get/comment/list/by/act/1/';
				var data = {
					act_id:api.pageParam.id
				};
				ajaxs(url,'get',data,false,function(ret){
					log(ret,true);
					var html = H.tppl(H.D('#tpl_commentList').innerHTML, {
						list: ret.data.list
					});
					$("#commentList").html(html).fadeIn();
					api.parseTapmode();
				},function(ret,err){
					log(ret,true);
					log(err,true);
				});
			};

			function showDetailMore(obj){
				var isShow = $(obj).attr('data-showOpen');
				if (isShow == "false") {
					$('#details').removeClass("H-text-show-row-3");
					$(obj).find('.H-iconfont').removeClass("H-icon-arrow-down").addClass("H-icon-arrow-up");
					$(obj).attr('data-showOpen', 'true');
				} else {
					$('#details').addClass("H-text-show-row-3");
					$(obj).find('.H-iconfont').removeClass("H-icon-arrow-up").addClass("H-icon-arrow-down");
					$(obj).attr('data-showOpen', 'false');
				}
			};
			function openEnrol() {
				H.openFrame('activity_enrol', 'activity_enrol.html', {
					has_fee:has_fee,
					fee:fee,
					id:aid,
					uid:1,
					person:person,
					personCount:personCount
				}, {
					rect : {
						x : 0,
						y : 0,
						w : 'auto',
						h : 'auto'
					},
					bounces : false,
					animation : {
						type : "fade",
						duration : 0
					}
				});
			};
			function openComment(){
				H.openFrame('activity_comment', 'activity_comment.html', {
					aid:aid,
					uid:1
				}, {
					rect : {
						x : 0,
						y : 0,
						w : 'auto',
						h : 'auto'
					},
					bounces : false,
					animation : {
						type : "fade",
						duration : 0
					}
				});
			};
			function openWin(title, name, url) {
				H.openWin('base_head_' + name, 'widget://html/comPages/base_head.html', {
					title : title,
					name : name,
					url : url,
					id: aid
				});
			};
			function openEnrolList() {
				openWin('报名', 'activity_enrolList', '../tab01/activity_enrolList.html');
			};
			function openUserHomepage(type,id) {
				var name = type==0?'user_homepage_head0':'user_homepage_head';
				H.openWin(name, '../user/'+name+'.html',{
					userId:id
				});
			};
		</script>
	</body>
</html>
